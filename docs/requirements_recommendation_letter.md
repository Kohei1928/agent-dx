# 推薦文作成機能 要件定義書

## 1. 機能概要

求職者の面談書き起こしデータ、履歴書、職務経歴書のデータをもとに、AIが企業への推薦文を自動生成する機能。職種別のテンプレート（作成ルール）を選択し、それに基づいた推薦文を生成する。

---

## 2. 機能詳細

### 2.1 推薦文テンプレート管理

#### 2.1.1 テンプレート項目
| 項目 | 必須 | 説明 |
|------|------|------|
| 職種名 | ○ | テンプレートの識別名（例：エンジニア職） |
| 推薦文作成時のポイント | ○ | AI生成時に考慮するルール・ポイント |
| 推薦文の例文 | - | 参考となる推薦文のサンプル |

#### 2.1.2 初期テンプレート
以下の3つを初期データとして用意：

1. **エンジニア職**
   - ポイント：継続力や学習力をアピール、技術スタックの明記、ブランク期間の説明

2. **携帯販売職**
   - ポイント：コミュニケーション能力、販売実績、顧客対応力のアピール

3. **事務職**
   - ポイント：正確性、PCスキル、業務効率化の経験

#### 2.1.3 テンプレート操作
- **追加**: 新規テンプレートの作成
- **編集**: 既存テンプレートの修正
- **削除**: 不要なテンプレートの削除
- **権限**: 全CAが操作可能

---

### 2.2 推薦文生成

#### 2.2.1 入力データ
以下のデータをAIに渡して推薦文を生成：

| データソース | 用途 |
|-------------|------|
| 面談書き起こしデータ | 人柄、志向性、経験の詳細 |
| 履歴書データ | 基本情報、学歴、職歴 |
| 職務経歴書データ | 業務内容、成果、スキル |
| 選択したテンプレート | 作成ルール、ポイント、例文 |

#### 2.2.2 生成仕様
- **文字数**: 500〜1000文字
- **生成エンジン**: Gemini API
- **プロンプト構成**:
  1. テンプレートの作成ポイント
  2. 参考例文（登録されている場合）
  3. 求職者データ
  4. 出力形式の指定

#### 2.2.3 保存仕様
- 求職者ごとに**最新の1件のみ**保存
- 再生成時は上書き

---

### 2.3 生成後の編集機能

#### 2.3.1 チャット形式の追加編集
生成された推薦文に対して、追加の指示を送信可能：
- 例：「もっとフォーマルな文体にして」
- 例：「具体的な数値を追加して」
- 例：「ブランク期間の説明をもっと詳しく」

#### 2.3.2 直接テキスト編集
- テキストエリアで直接編集可能
- 編集後は手動で保存

---

### 2.4 出力機能

#### 2.4.1 テキストコピー
- 「コピー」ボタンでクリップボードにコピー
- コピー成功時にトースト通知

#### 2.4.2 PDF出力
- 「PDFダウンロード」ボタンで出力
- フォーマット: A4、日本語フォント対応
- ファイル名: `推薦文_{求職者名}_{日付}.pdf`

---

## 3. UI/UX設計

### 3.1 サイドメニュー追加
```
📊 ダッシュボード
👥 求職者一覧
➕ 新規求職者登録
📅 日程調整
📝 推薦文設定  ← 新規追加
⚙️ HubSpotマッピング設定
```

### 3.2 推薦文設定ページ
```
┌─────────────────────────────────────────────────────────┐
│ 推薦文設定                                              │
├─────────────────────────────────────────────────────────┤
│ [+ 新規テンプレート追加]                                 │
│                                                         │
│ ┌─────────────────────────────────────────────────────┐ │
│ │ エンジニア職                              [編集][削除] │
│ │ ポイント: 継続力や学習力をアピール...                  │
│ └─────────────────────────────────────────────────────┘ │
│ ┌─────────────────────────────────────────────────────┐ │
│ │ 携帯販売職                               [編集][削除] │
│ │ ポイント: コミュニケーション能力...                    │
│ └─────────────────────────────────────────────────────┘ │
│ ┌─────────────────────────────────────────────────────┐ │
│ │ 事務職                                   [編集][削除] │
│ │ ポイント: 正確性、PCスキル...                         │
│ └─────────────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────────┘
```

### 3.3 テンプレート編集モーダル
```
┌─────────────────────────────────────────────────────────┐
│ テンプレート編集                                    [×] │
├─────────────────────────────────────────────────────────┤
│ 職種名 *                                                │
│ ┌─────────────────────────────────────────────────────┐ │
│ │ エンジニア職                                        │ │
│ └─────────────────────────────────────────────────────┘ │
│                                                         │
│ 推薦文作成時のポイント *                                 │
│ ┌─────────────────────────────────────────────────────┐ │
│ │ ・継続力や学習力をアピールする文章にすること          │ │
│ │ ・ブランク期間(6ヶ月以上)や早期離職等があれば...      │ │
│ └─────────────────────────────────────────────────────┘ │
│                                                         │
│ 推薦文の例文（任意）                                     │
│ ┌─────────────────────────────────────────────────────┐ │
│ │ 〇〇様は、前職でWeb開発エンジニアとして...           │ │
│ └─────────────────────────────────────────────────────┘ │
│                                                         │
│                              [キャンセル] [保存]         │
└─────────────────────────────────────────────────────────┘
```

### 3.4 求職者詳細ページへのボタン追加
```
┌─────────────────────────────────────────────────────────┐
│ 山田 太郎                                               │
│                                                         │
│ [📄 レジュメ編集] [📅 日程調整] [✉️ 推薦文作成]          │
│                                    ↑ 新規追加            │
└─────────────────────────────────────────────────────────┘
```

### 3.5 推薦文作成ページ
```
┌─────────────────────────────────────────────────────────┐
│ ← 戻る    推薦文作成 - 山田 太郎                         │
├─────────────────────────────────────────────────────────┤
│                                                         │
│ 職種テンプレートを選択                                   │
│ ┌─────────────────────────────────────────────────────┐ │
│ │ エンジニア職                                    ▼   │ │
│ └─────────────────────────────────────────────────────┘ │
│                                                         │
│ [🤖 推薦文を生成]                                        │
│                                                         │
├─────────────────────────────────────────────────────────┤
│ 生成された推薦文                                         │
│ ┌─────────────────────────────────────────────────────┐ │
│ │ 〇〇様をご推薦申し上げます。                         │ │
│ │                                                     │ │
│ │ 〇〇様は、前職で3年間Webエンジニアとして従事され、   │ │
│ │ フロントエンド開発を中心に...                        │ │
│ │                                                     │ │
│ │                                           [編集可能] │ │
│ └─────────────────────────────────────────────────────┘ │
│                                                         │
│ [📋 コピー] [📄 PDFダウンロード] [💾 保存]               │
│                                                         │
├─────────────────────────────────────────────────────────┤
│ 追加の編集指示                                           │
│ ┌─────────────────────────────────────────────────────┐ │
│ │ もっとフォーマルな文体にして                        │ │
│ └─────────────────────────────────────────────────────┘ │
│ [送信]                                                  │
│                                                         │
│ 編集履歴:                                               │
│ ・「もっとフォーマルに」→ 適用済み                       │
│ ・「具体例を追加」→ 適用済み                             │
└─────────────────────────────────────────────────────────┘
```

---

## 4. データベース設計

### 4.1 新規テーブル

#### RecommendationTemplate（推薦文テンプレート）
| カラム | 型 | 説明 |
|--------|------|------|
| id | String | 主キー（CUID） |
| name | String | 職種名 |
| points | String | 作成時のポイント |
| exampleText | String? | 例文（任意） |
| createdAt | DateTime | 作成日時 |
| updatedAt | DateTime | 更新日時 |

#### RecommendationLetter（推薦文）
| カラム | 型 | 説明 |
|--------|------|------|
| id | String | 主キー（CUID） |
| jobSeekerId | String | 求職者ID（FK） |
| templateId | String | 使用テンプレートID（FK） |
| content | String | 推薦文本文 |
| editHistory | Json? | 編集履歴（チャット形式） |
| createdAt | DateTime | 作成日時 |
| updatedAt | DateTime | 更新日時 |

---

## 5. API設計

### 5.1 テンプレート関連

| メソッド | エンドポイント | 説明 |
|----------|----------------|------|
| GET | /api/recommendation-templates | テンプレート一覧取得 |
| POST | /api/recommendation-templates | テンプレート作成 |
| PUT | /api/recommendation-templates/:id | テンプレート更新 |
| DELETE | /api/recommendation-templates/:id | テンプレート削除 |

### 5.2 推薦文関連

| メソッド | エンドポイント | 説明 |
|----------|----------------|------|
| GET | /api/job-seekers/:id/recommendation | 推薦文取得 |
| POST | /api/job-seekers/:id/recommendation/generate | 推薦文生成 |
| PUT | /api/job-seekers/:id/recommendation | 推薦文更新（直接編集） |
| POST | /api/job-seekers/:id/recommendation/refine | 追加編集（チャット） |
| GET | /api/job-seekers/:id/recommendation/pdf | PDF出力 |

---

## 6. 実装優先順位

### Phase 1: 基盤構築
1. [ ] DBスキーマ追加（Prisma）
2. [ ] 初期テンプレートデータ投入
3. [ ] テンプレートCRUD API

### Phase 2: 設定画面
4. [ ] サイドメニューに「推薦文設定」追加
5. [ ] テンプレート一覧ページ
6. [ ] テンプレート追加/編集モーダル

### Phase 3: 生成機能
7. [ ] 求職者詳細ページに「推薦文作成」ボタン追加
8. [ ] 推薦文作成ページ
9. [ ] AI生成API（Gemini連携）
10. [ ] 推薦文の保存機能

### Phase 4: 編集・出力機能
11. [ ] 直接テキスト編集機能
12. [ ] チャット形式の追加編集機能
13. [ ] コピー機能
14. [ ] PDF出力機能

---

## 7. 注意事項

- 推薦文は求職者ごとに最新1件のみ保存（再生成で上書き）
- テンプレートは全CAが編集可能
- 企業データは使用しない
- 生成時の編集履歴はJSON形式で保存

---

## 8. 変更履歴

| 日付 | 内容 |
|------|------|
| 2024-11-30 | 初版作成 |









