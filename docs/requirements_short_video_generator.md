# 要件定義書: 縦型ショート動画 自動生成・投稿システム

## 1. プロジェクト概要

### 1.1 目的
TikTokやMETA（Instagram Reels, Facebook Reels）向けの縦型ショート動画を、AIを活用して自動生成するシステム。台本作成から動画・音声生成、さらにオーガニックアカウントへの自動投稿までを一貫して行い、SNSコンテンツ制作・運用の効率化を実現する。

### 1.2 対象コンテンツ
- **オーガニック投稿**（通常投稿）向けのショート動画
- ブランド認知、エンゲージメント獲得、フォロワー増加を目的としたコンテンツ
- 広告配信ではなく、通常アカウントからの投稿

### 1.3 技術スタック
| カテゴリ | 技術 |
|---------|------|
| フロントエンド | Next.js (App Router) |
| スタイリング | Tailwind CSS |
| ORM | Prisma |
| データベース | PostgreSQL |
| 本番環境 | Google Cloud |
| 動画生成 | Google Veo 3.1 |
| ナレーション生成 | ElevenLabs |
| BGM | ロイヤリティフリー素材（事前登録） |
| 台本生成 | Google Gemini |
| 認証 | メール + パスワード認証（JWT） |
| SNS連携 | TikTok Content Posting API, Meta Graph API |

### 1.4 動画仕様
- 解像度: 1080 x 1920（縦型9:16）
- 対応秒数: 15秒 / 30秒 / 60秒

### 1.5 制作フロー概要

```
┌─────────────────────────────────────────────────────────────────┐
│                        制作フロー                                │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  ① 事前準備                                                     │
│  ┌─────────────┐    ┌─────────────┐    ┌─────────────┐         │
│  │ 商品登録    │    │ BGM登録     │    │ ガイドライン │         │
│  │             │    │             │    │ 設定        │         │
│  └─────────────┘    └─────────────┘    └─────────────┘         │
│                                                                 │
│  ② プロジェクト作成                                              │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │ プロジェクト作成 → 商品選択 → 基本設定入力                 │   │
│  └─────────────────────────────────────────────────────────┘   │
│                                                                 │
│  ③ 台本作成（反復改善）                                          │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │                                                           │   │
│  │   ┌──────────┐     ┌──────────┐     ┌──────────┐         │   │
│  │   │ 台本生成  │────>│ レビュー  │────>│ 承認     │         │   │
│  │   │ (AI)     │     │          │     │          │         │   │
│  │   └──────────┘     └────┬─────┘     └──────────┘         │   │
│  │                         │                                 │   │
│  │                    修正が必要                              │   │
│  │                         │                                 │   │
│  │                         ▼                                 │   │
│  │                  ┌──────────────┐                         │   │
│  │                  │ フィードバック │                         │   │
│  │                  │ 入力          │                         │   │
│  │                  └──────┬───────┘                         │   │
│  │                         │                                 │   │
│  │                         ▼                                 │   │
│  │                  ┌──────────────┐                         │   │
│  │                  │ 台本改善     │──────┐                  │   │
│  │                  │ (AI)        │      │                  │   │
│  │                  └──────────────┘      │                  │   │
│  │                         ▲              │                  │   │
│  │                         └──────────────┘                  │   │
│  │                        (繰り返し可能)                      │   │
│  │                                                           │   │
│  └─────────────────────────────────────────────────────────┘   │
│                                                                 │
│  ④ 動画・音声生成                                                │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │ カット編集 → BGM選択 → 動画生成(Veo) → 音声生成(ElevenLabs)│   │
│  └─────────────────────────────────────────────────────────┘   │
│                                                                 │
│  ⑤ 完成・出力                                                    │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │ プレビュー確認 → ダウンロード                              │   │
│  └─────────────────────────────────────────────────────────┘   │
│                                                                 │
│  ⑥ SNS投稿                                                       │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │ 投稿先選択 → キャプション設定 → スケジュール → 投稿実行    │   │
│  │                                                           │   │
│  │   ┌──────────┐  ┌──────────┐  ┌──────────┐              │   │
│  │   │  TikTok  │  │Instagram │  │ Facebook │              │   │
│  │   │          │  │  Reels   │  │          │              │   │
│  │   └──────────┘  └──────────┘  └──────────┘              │   │
│  └─────────────────────────────────────────────────────────┘   │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

---

## 2. ユースケース

### 2.1 ユースケース一覧

| UC-ID | ユースケース名 | アクター | 概要 |
|-------|---------------|---------|------|
| UC-01 | ユーザー登録・ログイン | ユーザー | システムへの認証 |
| UC-02 | 商品/サービス登録 | ユーザー | 動画で紹介する商品・サービス情報をマスタ登録 |
| UC-03 | 商品/サービス編集・削除 | ユーザー | 登録済み商品・サービス情報の管理 |
| UC-04 | プロジェクト作成 | ユーザー | 新規動画広告プロジェクトを作成 |
| UC-05 | 台本生成 | ユーザー | AIによる台本自動生成 |
| UC-05b | 台本フィードバック・改善 | ユーザー | 自然言語でフィードバックし台本をブラッシュアップ |
| UC-05c | 台本承認 | ユーザー | 台本を確定し動画生成フェーズへ進む |
| UC-06 | 台本編集 | ユーザー | 生成された台本の手動編集 |
| UC-07 | カット割り調整 | ユーザー | 各カットの内容・秒数の調整 |
| UC-08 | 動画生成 | ユーザー | Veo 3.1による動画生成 |
| UC-09 | ナレーション生成 | ユーザー | 各カットのナレーション音声生成（ElevenLabs） |
| UC-09b | BGM選択 | ユーザー | ロイヤリティフリーBGMの選択 |
| UC-10 | 動画プレビュー | ユーザー | 生成された動画のプレビュー確認 |
| UC-11 | 動画ダウンロード | ユーザー | 完成動画のダウンロード |
| UC-12 | バリエーション生成 | ユーザー | A/Bテスト用の複数バリエーション作成 |
| UC-13 | プロジェクト履歴閲覧 | ユーザー | 過去のプロジェクト・生成物の閲覧 |
| UC-14 | BGM素材管理 | ユーザー | ロイヤリティフリーBGM素材の登録・管理 |
| UC-15 | 台本ガイドライン管理 | ユーザー | 良い台本の定義・ルールを登録・管理 |
| UC-16 | SNSアカウント連携 | ユーザー | TikTok/META アカウントをOAuth連携 |
| UC-17 | 動画投稿 | ユーザー | 生成した動画をSNSに投稿 |
| UC-18 | 投稿スケジュール設定 | ユーザー | 投稿日時を予約設定 |
| UC-19 | 投稿履歴・ステータス確認 | ユーザー | 投稿済み動画の一覧・ステータス確認 |

### 2.2 ユースケース詳細

#### UC-05: 台本生成

**概要**: ユーザーが入力した情報をもとに、AIがカット割りを含む台本を自動生成する

**事前条件**:
- ユーザーがログイン済み
- プロジェクトが作成済み
- 商品/サービスが選択済み
- （任意）台本ガイドラインが登録済み

**基本フロー**:
1. ユーザーが台本生成に必要な情報を入力
2. システムが動画秒数からカット数を自動算出
3. AIが入力情報 + 台本ガイドラインをもとに台本を生成
4. 各カットに対応した映像指示・セリフ・音声指示を出力
5. ユーザーが台本を確認

**代替フロー**:
- 3a. 生成に失敗した場合、エラーメッセージを表示し再試行を促す
- 5a. 台本に問題がある場合、UC-05b（フィードバック・改善）へ
- 5b. 台本がOKの場合、UC-05c（台本承認）へ

**事後条件**:
- 台本データが保存される（ステータス: レビュー中）
- カット割りデータが保存される

---

#### UC-05b: 台本フィードバック・改善

**概要**: 生成された台本に対して自然言語でフィードバックし、AIが改善版を生成する

**事前条件**:
- 台本が生成済み（ステータス: レビュー中）

**基本フロー**:
1. ユーザーが台本の改善点・修正指示を自然言語で入力
   - 例：「冒頭のフックがもっとインパクト欲しい」
   - 例：「カット3のセリフが長すぎるので短くして」
   - 例：「全体的にもっとカジュアルなトーンにして」
2. AIが既存の台本 + フィードバック + ガイドラインを考慮して改善版を生成
3. 変更箇所をハイライトして表示
4. ユーザーが改善版を確認

**代替フロー**:
- 4a. さらに修正が必要な場合、1に戻る（反復改善）
- 4b. 改善版がOKの場合、UC-05c（台本承認）へ
- 4c. 改善前のバージョンに戻したい場合、履歴から復元

**事後条件**:
- 改善版の台本が新バージョンとして保存される
- フィードバック履歴が保存される

---

#### UC-05c: 台本承認

**概要**: 台本を確定し、カット編集フェーズへ進む

**事前条件**:
- 台本がレビュー完了（ユーザーが内容に納得）

**基本フロー**:
1. ユーザーが「台本を承認」ボタンをクリック
2. システムが台本ステータスを「承認済み」に更新
3. カット編集画面（SCR-09）へ遷移
4. ユーザーがカットの詳細（映像指示、セリフ等）を微調整
5. 調整完了後、動画生成画面（SCR-10）へ進む

**事後条件**:
- 台本ステータスが「承認済み」に変更
- カット編集・動画生成が可能になる

---

#### UC-15: 台本ガイドライン管理

**概要**: 良い広告台本の定義・ルールを登録し、台本生成時にAIが参照する

**事前条件**:
- ユーザーがログイン済み

**基本フロー**:
1. ユーザーがガイドライン管理画面にアクセス
2. 以下の情報を入力・編集:
   - 良い台本の特徴・ルール
   - 避けるべきパターン
   - 参考にすべき成功事例の台本
   - 業界/商材別の注意点
3. 保存

**ガイドライン例**:
```
【良い台本の定義】
- 冒頭3秒で視聴者の注意を引くフックがある
- 共感→気づき→解決策の流れが明確
- 1カットにつき1メッセージに絞る
- エンディングでアクションを促す（保存、フォロー等）
- ターゲットの言葉遣いに合わせる

【避けるべきパターン】
- 説明が長すぎる（1カット5秒を超えるセリフ）
- 抽象的な表現（「すごい」「素晴らしい」など）
- 冒頭から説明に入る（フックがない）
- オチやまとめがない

【成功事例メモ】
- 「あるある」フックで視聴継続率80%
- 具体的な数字（「たった3分で」など）で保存率2倍
- 締めに「〇〇な人はフォロー」で新規フォロワー増
```

**事後条件**:
- ガイドラインが保存される
- 以降の台本生成時にAIが参照する

---

#### UC-12: バリエーション生成

**概要**: A/Bテスト用に、既存の台本をベースとして複数のバリエーションを作成する

**事前条件**:
- プロジェクトに少なくとも1つの台本が存在

**基本フロー**:
1. ユーザーがバリエーション管理画面にアクセス
2. 「新しいバリエーションを追加」をクリック
3. バリエーション作成方法を選択:
   - **コピーして編集**: 既存の台本をコピーし、手動で修正
   - **AIで別パターン生成**: 同じ入力情報で異なるアプローチの台本を生成
4. バリエーション名を入力（例: パターンB、感情訴求版）
5. 台本を編集・確定
6. 必要に応じて動画を生成

**バリエーション例**:
| バリエーション | 変更点 |
|--------------|-------|
| パターンA（オリジナル） | 憧れ型訴求、女性ナレーション |
| パターンB | 不安解消型訴求、同じ映像 |
| パターンC | 同じ訴求、男性ナレーション |

**事後条件**:
- 新しいバリエーションが作成される
- 各バリエーションで独立して動画生成が可能

---

#### UC-16: SNSアカウント連携

**概要**: TikTok、Instagram、Facebookのオーガニックアカウントをお認証で連携する

**事前条件**:
- ユーザーがログイン済み
- 各プラットフォームのアカウントを保有

**基本フロー**:
1. ユーザーがアカウント連携画面にアクセス
2. 連携したいプラットフォームを選択
3. OAuth認証画面にリダイレクト
4. ユーザーがプラットフォーム側で認可
5. コールバックでアクセストークンを取得・保存
6. 連携完了を表示

**対応プラットフォーム**:
| プラットフォーム | API | 必要な権限 |
|----------------|-----|-----------|
| TikTok | TikTok Content Posting API | video.upload, video.publish |
| Instagram | Meta Graph API | instagram_content_publish |
| Facebook | Meta Graph API | pages_manage_posts |

**アカウントタイプ**:
- TikTok: 通常アカウント or クリエイターアカウント
- Instagram: プロフェッショナルアカウント（クリエイター/ビジネス）
- Facebook: Facebookページ

**事後条件**:
- アクセストークン・リフレッシュトークンが暗号化して保存される
- 連携済みアカウントが一覧に表示される

---

#### UC-17: 動画投稿

**概要**: 生成した動画をSNSに投稿する

**事前条件**:
- 動画が生成完了済み
- 投稿先のSNSアカウントが連携済み

**基本フロー**:
1. ユーザーがプレビュー画面から「投稿する」を選択
2. 投稿先プラットフォームを選択（複数選択可）
3. 各プラットフォーム向けの投稿設定を入力:
   - キャプション（説明文）
   - ハッシュタグ
   - メンション（任意）
4. 投稿方法を選択:
   - **今すぐ投稿**: 即時投稿
   - **スケジュール投稿**: 日時指定
5. 投稿実行（またはスケジュール登録）
6. 投稿ステータスを表示

**プラットフォーム別制限**:
| プラットフォーム | キャプション上限 | ハッシュタグ上限 | 動画長さ上限 |
|----------------|-----------------|-----------------|-------------|
| TikTok | 2,200文字 | 制限なし | 10分 |
| Instagram Reels | 2,200文字 | 30個 | 90秒 |
| Facebook | 63,206文字 | 制限なし | 240分 |

**事後条件**:
- 投稿レコードが作成される
- 投稿完了後、投稿URLが保存される

---

#### UC-18: 投稿スケジュール設定

**概要**: 動画の投稿日時を予約設定する

**事前条件**:
- 動画が生成完了済み
- SNSアカウントが連携済み

**基本フロー**:
1. ユーザーが投稿画面でスケジュール投稿を選択
2. 投稿日時を指定（カレンダー + 時刻）
3. タイムゾーンを確認
4. スケジュールを保存

**スケジュール実行**:
- バックグラウンドジョブが定期的にスケジュールをチェック
- 投稿時刻になったらAPIを実行
- 成功/失敗をユーザーに通知（メール or アプリ内通知）

**事後条件**:
- スケジュールレコードが作成される
- 指定時刻に自動投稿が実行される

---

#### UC-19: 投稿履歴・ステータス確認

**概要**: 投稿済み動画の一覧とステータスを確認する

**事前条件**:
- ユーザーがログイン済み

**基本フロー**:
1. ユーザーが投稿履歴画面にアクセス
2. 投稿一覧を表示（日付順）
3. 各投稿のステータスを確認:
   - スケジュール済み
   - 投稿中
   - 投稿完了
   - 投稿失敗
4. 投稿完了分は投稿先URLにアクセス可能
5. 簡易パフォーマンス指標を表示（再生数、いいね等）

**表示項目**:
- サムネイル
- プロジェクト名
- 投稿先プラットフォーム
- 投稿日時
- ステータス
- 再生数/いいね数（取得可能な場合）

**事後条件**:
- なし（閲覧のみ）

---

## 3. 画面設計

### 3.1 画面一覧

| 画面ID | 画面名 | パス | 概要 |
|--------|-------|------|------|
| SCR-01 | ログイン画面 | `/login` | ユーザー認証 |
| SCR-02 | ユーザー登録画面 | `/register` | 新規ユーザー登録 |
| SCR-03 | ダッシュボード | `/dashboard` | プロジェクト一覧・統計表示 |
| SCR-04 | 商品/サービス一覧 | `/products` | 登録済み商品・サービスの一覧 |
| SCR-05 | 商品/サービス登録・編集 | `/products/[id]` | 商品・サービス情報の入力 |
| SCR-06 | プロジェクト一覧 | `/projects` | 作成済みプロジェクトの一覧 |
| SCR-07 | プロジェクト作成 | `/projects/new` | 新規プロジェクト作成 |
| SCR-08 | 台本生成 | `/projects/[id]/script` | 台本生成の入力・結果表示 |
| SCR-09 | カット編集 | `/projects/[id]/cuts` | カット割りの詳細編集 |
| SCR-10 | 動画生成 | `/projects/[id]/generate` | 動画・音声生成の実行 |
| SCR-11 | プレビュー・ダウンロード | `/projects/[id]/preview` | 生成物の確認・DL |
| SCR-12 | バリエーション管理 | `/projects/[id]/variations` | A/Bテスト用バリエーション管理 |
| SCR-13 | プロジェクト履歴 | `/projects/[id]/history` | 生成履歴の閲覧 |
| SCR-14 | BGM管理 | `/bgm` | BGM素材の一覧・登録・削除 |
| SCR-15 | 台本ガイドライン | `/settings/script-guidelines` | 良い台本の定義・ルール管理 |
| SCR-16 | SNSアカウント連携 | `/settings/sns-accounts` | SNSアカウントのOAuth連携管理 |
| SCR-17 | 投稿設定 | `/projects/[id]/publish` | 動画の投稿先・キャプション設定 |
| SCR-18 | 投稿履歴 | `/posts` | 投稿済み動画の一覧・ステータス確認 |

### 3.2 画面詳細

#### SCR-08: 台本生成画面

```
┌─────────────────────────────────────────────────────────────────┐
│  ← プロジェクト名: 夏キャンペーン動画                              │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  ■ 基本設定                                                     │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │ 対象商品/サービス: [ドロップダウン選択]                    │   │
│  │ 動画秒数: ○15秒  ●30秒  ○60秒                           │   │
│  │ 推定カット数: 6カット（自動算出）                          │   │
│  └─────────────────────────────────────────────────────────┘   │
│                                                                 │
│  ■ ターゲット設定                                               │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │ ペルソナ詳細:                                             │   │
│  │ [年齢: 25-34歳 ▼] [性別: 女性 ▼] [職業: 会社員 ▼]        │   │
│  │                                                           │   │
│  │ ライフスタイル:                                           │   │
│  │ [テキストエリア: 仕事が忙しく、時短を求めている...]        │   │
│  │                                                           │   │
│  │ 抱えている課題・悩み:                                     │   │
│  │ [テキストエリア: 毎朝のメイクに時間がかかりすぎる...]      │   │
│  │                                                           │   │
│  │ 理想の状態（ビフォーアフター）:                            │   │
│  │ [テキストエリア: 5分でプロ級のメイクが完成する...]         │   │
│  └─────────────────────────────────────────────────────────┘   │
│                                                                 │
│  ■ コンテンツ設定                                               │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │ メインメッセージ:                                         │   │
│  │ [テキスト: 時短なのにプロ級仕上がり]                       │   │
│  │                                                           │   │
│  │ コンテンツタイプ:                                         │   │
│  │ ○情報提供  ●共感・あるある  ○ハウツー  ○エンタメ        │   │
│  │                                                           │   │
│  │ フック（冒頭3秒の掴み）:                                  │   │
│  │ [テキスト: まだ朝のメイクに30分かけてるの？]               │   │
│  │                                                           │   │
│  │ エンディング（締めの一言）:                               │   │
│  │ [テキスト: 気になったらフォローして🙌]                     │   │
│  └─────────────────────────────────────────────────────────┘   │
│                                                                 │
│  ■ トンマナ設定                                                 │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │ 動画のテイスト:                                           │   │
│  │ ○カジュアル  ●フォーマル  ○ユーモア  ○エモーショナル     │   │
│  │                                                           │   │
│  │ 映像スタイル:                                             │   │
│  │ ○実写風  ●シネマティック  ○アニメ風  ○ミニマル          │   │
│  └─────────────────────────────────────────────────────────┘   │
│                                                                 │
│  ■ Veo 3.1 向け設定                                             │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │ 登場人物設定:                                             │   │
│  │ [テキストエリア: 20代後半の女性、ナチュラルメイク...]      │   │
│  │                                                           │   │
│  │ ロケーション設定:                                         │   │
│  │ [テキストエリア: モダンな白基調のバスルーム...]            │   │
│  └─────────────────────────────────────────────────────────┘   │
│                                                                 │
│  ■ 追加設定                                                     │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │ 必須キーワード:                                           │   │
│  │ [タグ入力: 時短, プロ級, 簡単]                             │   │
│  │                                                           │   │
│  │ NG表現:                                                   │   │
│  │ [タグ入力: 最安値, 業界初]                                 │   │
│  │                                                           │   │
│  │ 参考動画URL:                                              │   │
│  │ [URL入力欄]                                               │   │
│  └─────────────────────────────────────────────────────────┘   │
│                                                                 │
│  ┌─────────────────┐                                           │
│  │  🎬 台本を生成   │                                           │
│  └─────────────────┘                                           │
│                                                                 │
├─────────────────────────────────────────────────────────────────┤
│  ■ 生成結果                              バージョン: v3 ▼       │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │ カット1 (0:00-0:03) - フック                    [変更あり]│   │
│  │ ├─ 映像: 女性が慌ただしく朝の準備をしているシーン          │   │
│  │ ├─ セリフ: 「まだ朝のメイクに30分かけてるの？」            │   │
│  │ └─ 音声: 疑問を投げかけるトーン、BGMなし                   │   │
│  │                                                           │   │
│  │ カット2 (0:03-0:08) - 問題提起                            │   │
│  │ ├─ 映像: 時計を気にしながらメイクする女性                  │   │
│  │ ├─ セリフ: 「忙しい朝、もっと時間が欲しい...」             │   │
│  │ └─ 音声: 共感を誘うトーン、軽いBGM                        │   │
│  │                                                           │   │
│  │ ... (カット3-6)                                           │   │
│  └─────────────────────────────────────────────────────────┘   │
│                                                                 │
│  ■ 台本フィードバック（AIへの改善指示）                          │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │ 💬 改善してほしい点を自由に入力してください:               │   │
│  │ ┌───────────────────────────────────────────────────────┐ │   │
│  │ │ 冒頭のフックをもっとインパクトのある疑問形にして。      │ │   │
│  │ │ カット3のベネフィット訴求が弱いので、具体的な数字を    │ │   │
│  │ │ 入れて説得力を増して。                                 │ │   │
│  │ └───────────────────────────────────────────────────────┘ │   │
│  │                                                           │   │
│  │ [🔄 フィードバックを反映して改善]                          │   │
│  └─────────────────────────────────────────────────────────┘   │
│                                                                 │
│  ■ フィードバック履歴                                           │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │ v3 ← v2: 「CTAをもっと具体的に」                          │   │
│  │ v2 ← v1: 「全体的にカジュアルなトーンに変更して」         │   │
│  │ v1: 初回生成                                              │   │
│  └─────────────────────────────────────────────────────────┘   │
│                                                                 │
│  [ゼロから再生成] [手動で編集]                                   │
│                                                                 │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │  ✅ この台本を承認してカット編集へ進む                     │   │
│  └─────────────────────────────────────────────────────────┘   │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

#### SCR-09: カット編集画面

```
┌─────────────────────────────────────────────────────────────────┐
│  ← 台本生成に戻る    プロジェクト名: 夏キャンペーン動画           │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  ■ カット一覧 (全6カット / 30秒)                                 │
│                                                                 │
│  ┌──────────────────────────────────────────────────────────┐  │
│  │ [タイムライン表示]                                        │  │
│  │ |--カット1--|--カット2--|--カット3--|--カット4--|--5--|--6-| │  │
│  │ 0s        3s          8s         14s        20s   25s  30s │  │
│  └──────────────────────────────────────────────────────────┘  │
│                                                                 │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │ ▼ カット1: フック (3秒)                          [編集]   │   │
│  ├─────────────────────────────────────────────────────────┤   │
│  │                                                           │   │
│  │  開始: 0:00  終了: 0:03  秒数: [3秒 ▼]                    │   │
│  │                                                           │   │
│  │  ┌─ 映像指示 ────────────────────────────────────────┐   │   │
│  │  │ [テキストエリア]                                   │   │   │
│  │  │ 女性が慌ただしく朝の準備をしているシーン。          │   │   │
│  │  │ カメラは女性の顔にクローズアップ。                  │   │   │
│  │  └───────────────────────────────────────────────────┘   │   │
│  │                                                           │   │
│  │  ┌─ セリフ ──────────────────────────────────────────┐   │   │
│  │  │ [テキストエリア]                                   │   │   │
│  │  │ まだ朝のメイクに30分かけてるの？                    │   │   │
│  │  └───────────────────────────────────────────────────┘   │   │
│  │                                                           │   │
│  │  ┌─ 音声指示 ────────────────────────────────────────┐   │   │
│  │  │ ナレーション: ●あり ○なし                         │   │   │
│  │  │ トーン: [疑問を投げかける ▼]                       │   │   │
│  │  │ BGM: ○なし ●控えめ ○通常                         │   │   │
│  │  └───────────────────────────────────────────────────┘   │   │
│  │                                                           │   │
│  └─────────────────────────────────────────────────────────┘   │
│                                                                 │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │ ▶ カット2: 問題提起 (5秒)                        [編集]   │   │
│  └─────────────────────────────────────────────────────────┘   │
│                                                                 │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │ ▶ カット3: 解決策提示 (6秒)                      [編集]   │   │
│  └─────────────────────────────────────────────────────────┘   │
│                                                                 │
│  ... (カット4-6)                                                │
│                                                                 │
│  [+ カットを追加]                                               │
│                                                                 │
│  [← 台本に戻る] [保存] [次へ: 動画生成 →]                        │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

#### SCR-10: 動画生成画面

```
┌─────────────────────────────────────────────────────────────────┐
│  ← カット編集に戻る    プロジェクト名: 夏キャンペーン動画         │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  ■ 生成設定                                                     │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │ 動画生成エンジン: Google Veo 3.1                         │   │
│  │ ナレーション生成: ElevenLabs                             │   │
│  │ 出力解像度: 1080 x 1920 (9:16)                           │   │
│  └─────────────────────────────────────────────────────────┘   │
│                                                                 │
│  ■ ナレーション音声設定                                          │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │ Voice: [Yuki - 女性・20代・明るくカジュアル ▼]            │   │
│  │                                                           │   │
│  │ ○ Yuki (女性・20代)  - 明るくカジュアル                   │   │
│  │ ● Hana (女性・30代)  - 落ち着いた信頼感                   │   │
│  │ ○ Takeshi (男性・30代) - 力強くエネルギッシュ             │   │
│  │ ○ Kenji (男性・40代)  - 落ち着いた説得力                  │   │
│  │                                                           │   │
│  │ [▶ サンプル試聴]                                          │   │
│  └─────────────────────────────────────────────────────────┘   │
│                                                                 │
│  ■ BGM設定                                                      │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │ カテゴリ: [アップビート ▼]                                │   │
│  │                                                           │   │
│  │ 🎵 Summer Vibes (2:30)              [▶試聴] [選択]        │   │
│  │ 🎵 Corporate Motion (1:45)          [▶試聴] [選択]        │   │
│  │ 🎵 Energy Boost (2:00)              [▶試聴] [✓選択中]     │   │
│  │                                                           │   │
│  │ 音量: [████████░░] 80%                                   │   │
│  └─────────────────────────────────────────────────────────┘   │
│                                                                 │
│  ■ カット別生成ステータス                                       │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │                                                           │   │
│  │  カット1 (フック)                                         │   │
│  │  ├─ 動画: ✅ 生成完了  [プレビュー] [再生成]              │   │
│  │  └─ 音声: ✅ 生成完了  [試聴] [再生成]                    │   │
│  │                                                           │   │
│  │  カット2 (問題提起)                                       │   │
│  │  ├─ 動画: 🔄 生成中... (45%)                              │   │
│  │  └─ 音声: ⏳ 待機中                                       │   │
│  │                                                           │   │
│  │  カット3 (解決策提示)                                     │   │
│  │  ├─ 動画: ⏳ 待機中                                       │   │
│  │  └─ 音声: ⏳ 待機中                                       │   │
│  │                                                           │   │
│  │  ... (カット4-6)                                          │   │
│  │                                                           │   │
│  └─────────────────────────────────────────────────────────┘   │
│                                                                 │
│  ■ 全体進捗                                                     │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │  [████████░░░░░░░░░░░░] 35% - 残り約8分                   │   │
│  └─────────────────────────────────────────────────────────┘   │
│                                                                 │
│  [すべて生成開始] [生成停止]                                     │
│                                                                 │
│  ※ 生成完了後、自動的に動画を結合します                          │
│                                                                 │
│  [← カット編集] [プレビュー →] [📤 SNSに投稿 →]                  │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

#### SCR-15: 台本ガイドライン画面

```
┌─────────────────────────────────────────────────────────────────┐
│  ⚙️ 設定 > 台本ガイドライン                                      │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  ℹ️ ここで設定した内容は、台本生成時にAIが参照します              │
│                                                                 │
│  ■ 良い台本の特徴・ルール                                        │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │ [テキストエリア]                                          │   │
│  │ ・冒頭3秒で視聴者の注意を引くフックを入れる                │   │
│  │ ・問題→解決→ベネフィットの流れを明確にする                │   │
│  │ ・1カットにつき1メッセージに絞る                          │   │
│  │ ・締めでアクション誘導（保存、フォロー等）                  │   │
│  │ ・ターゲットの言葉遣いに合わせる                          │   │
│  │ ・具体的な数字やデータを入れて説得力を出す                │   │
│  │ ・感情に訴える言葉を効果的に使う                          │   │
│  └─────────────────────────────────────────────────────────┘   │
│                                                                 │
│  ■ 避けるべきパターン                                            │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │ [テキストエリア]                                          │   │
│  │ ・1カットのセリフが5秒を超える長さ                        │   │
│  │ ・「すごい」「素晴らしい」など抽象的な表現                │   │
│  │ ・複数のCTAを入れる（1つに絞る）                          │   │
│  │ ・ネガティブ訴求のみで終わる                              │   │
│  │ ・機能説明ばかりでベネフィットがない                      │   │
│  └─────────────────────────────────────────────────────────┘   │
│                                                                 │
│  ■ 成功事例・参考メモ                                            │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │ [テキストエリア]                                          │   │
│  │ 【化粧品A 夏キャンペーン】                                │   │
│  │ ・疑問形フックで視聴継続率80%達成                         │   │
│  │ ・フック：「まだ夏のメイク崩れに悩んでる？」              │   │
│  │                                                           │   │
│  │ 【サプリB 定期購入訴求】                                  │   │
│  │ ・具体的な数字訴求でCVR 2倍                               │   │
│  │ ・「92%が実感」「たった30日で」などの数字が効果的         │   │
│  └─────────────────────────────────────────────────────────┘   │
│                                                                 │
│  ■ 業界・商材別の注意点                                          │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │ [テキストエリア]                                          │   │
│  │ 【美容・コスメ】                                          │   │
│  │ ・ビフォーアフターは薬機法に注意                          │   │
│  │ ・「個人の感想です」の注釈を入れる                        │   │
│  │                                                           │   │
│  │ 【健康食品】                                              │   │
│  │ ・効果効能の断言は避ける                                  │   │
│  │ ・「※効果には個人差があります」を必ず入れる              │   │
│  └─────────────────────────────────────────────────────────┘   │
│                                                                 │
│  ┌─────────────────┐                                           │
│  │  💾 保存する     │                                           │
│  └─────────────────┘                                           │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

#### SCR-16: SNSアカウント連携画面

```
┌─────────────────────────────────────────────────────────────────┐
│  ⚙️ 設定 > SNSアカウント連携                                     │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  ℹ️ 動画を直接投稿するには、各プラットフォームのアカウントを      │
│     連携してください                                             │
│                                                                 │
│  ■ 連携済みアカウント                                            │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │                                                           │   │
│  │  🎵 TikTok                                                │   │
│  │  ├─ アカウント: @your_brand_tiktok                        │   │
│  │  ├─ 連携日: 2024/01/15                                    │   │
│  │  └─ ステータス: ✅ 有効                                   │   │
│  │                                    [連携解除] [再認証]     │   │
│  │                                                           │   │
│  │  📸 Instagram                                             │   │
│  │  ├─ アカウント: @your_brand_insta                         │   │
│  │  ├─ 連携日: 2024/01/15                                    │   │
│  │  └─ ステータス: ✅ 有効                                   │   │
│  │                                    [連携解除] [再認証]     │   │
│  │                                                           │   │
│  │  📘 Facebook                                              │   │
│  │  └─ ステータス: ⚪ 未連携                                 │   │
│  │                                    [連携する]              │   │
│  │                                                           │   │
│  └─────────────────────────────────────────────────────────┘   │
│                                                                 │
│  ■ 新規連携                                                      │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │ 連携するプラットフォームを選択:                           │   │
│  │                                                           │   │
│  │ ┌─────────────┐ ┌─────────────┐ ┌─────────────┐         │   │
│  │ │   TikTok    │ │  Instagram  │ │  Facebook   │         │   │
│  │ │   🎵        │ │   📸        │ │   📘        │         │   │
│  │ │  [連携済]   │ │  [連携済]   │ │  [連携する] │         │   │
│  │ └─────────────┘ └─────────────┘ └─────────────┘         │   │
│  └─────────────────────────────────────────────────────────┘   │
│                                                                 │
│  ⚠️ 注意事項                                                    │
│  ・TikTokは通常アカウントまたはクリエイターアカウントが必要です   │
│  ・Instagramはプロフェッショナルアカウント（クリエイター推奨）    │
│  ・Facebookはページとして投稿します                              │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

#### SCR-17: 投稿設定画面

```
┌─────────────────────────────────────────────────────────────────┐
│  ← プレビューに戻る    プロジェクト名: 夏キャンペーン動画         │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  ■ 投稿する動画                                                  │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │ ┌─────────┐                                              │   │
│  │ │ 🎬      │  夏キャンペーン動画 - パターンA              │   │
│  │ │ サムネ  │  30秒 | 1080x1920                            │   │
│  │ │         │  生成日: 2024/01/20                          │   │
│  │ └─────────┘                                              │   │
│  └─────────────────────────────────────────────────────────┘   │
│                                                                 │
│  ■ 投稿先を選択（複数選択可）                                    │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │ ☑️ TikTok (@your_brand_tiktok)                           │   │
│  │ ☑️ Instagram Reels (@your_brand_insta)                   │   │
│  │ ☐ Facebook (Your Brand Page)                             │   │
│  └─────────────────────────────────────────────────────────┘   │
│                                                                 │
│  ■ キャプション設定                                              │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │ キャプション（説明文）:                                   │   │
│  │ ┌───────────────────────────────────────────────────────┐ │   │
│  │ │ 【新商品】時短メイクの革命✨                           │ │   │
│  │ │ 忙しい朝でもたった5分でプロ級の仕上がり！              │ │   │
│  │ │                                                       │ │   │
│  │ │ 詳しくはプロフィールのリンクから👆                     │ │   │
│  │ └───────────────────────────────────────────────────────┘ │   │
│  │                                    文字数: 85 / 2,200     │   │
│  │                                                           │   │
│  │ ハッシュタグ:                                             │   │
│  │ [タグ入力: #時短メイク, #新商品, #PR, #コスメ]            │   │
│  │                                    タグ数: 4 / 30         │   │
│  │                                                           │   │
│  │ [💡 AIでキャプション生成]                                 │   │
│  └─────────────────────────────────────────────────────────┘   │
│                                                                 │
│  ■ 投稿タイミング                                                │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │ ● 今すぐ投稿                                              │   │
│  │ ○ スケジュール投稿                                        │   │
│  │                                                           │   │
│  │   日付: [2024/01/25 ▼]  時刻: [18:00 ▼]                  │   │
│  │   タイムゾーン: Asia/Tokyo (JST)                          │   │
│  │                                                           │   │
│  │   💡 おすすめ投稿時間: 平日 18:00-21:00                   │   │
│  └─────────────────────────────────────────────────────────┘   │
│                                                                 │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │  🚀 投稿する                                              │   │
│  └─────────────────────────────────────────────────────────┘   │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

#### SCR-18: 投稿履歴画面

```
┌─────────────────────────────────────────────────────────────────┐
│  📋 投稿履歴                                                     │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  ■ フィルター                                                    │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │ プラットフォーム: [すべて ▼]  ステータス: [すべて ▼]      │   │
│  │ 期間: [過去30日 ▼]                                        │   │
│  └─────────────────────────────────────────────────────────┘   │
│                                                                 │
│  ■ 投稿一覧                                                      │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │                                                           │   │
│  │  ┌─────┐ 夏キャンペーン動画 - パターンA                   │   │
│  │  │🎬   │ 🎵TikTok  📸Instagram                           │   │
│  │  │     │ 投稿日時: 2024/01/20 18:00                       │   │
│  │  └─────┘ ステータス: ✅ 投稿完了                          │   │
│  │          ├─ TikTok: 👁 12,500再生 ❤️ 834いいね            │   │
│  │          └─ Instagram: 👁 8,200再生 ❤️ 521いいね          │   │
│  │                                    [詳細] [投稿を見る]     │   │
│  │  ─────────────────────────────────────────────────────── │   │
│  │                                                           │   │
│  │  ┌─────┐ 春の新商品PR                                     │   │
│  │  │🎬   │ 🎵TikTok                                        │   │
│  │  │     │ 予定日時: 2024/01/25 19:00                       │   │
│  │  └─────┘ ステータス: 🕐 スケジュール済み                  │   │
│  │                                    [編集] [キャンセル]     │   │
│  │  ─────────────────────────────────────────────────────── │   │
│  │                                                           │   │
│  │  ┌─────┐ 冬セール告知                                     │   │
│  │  │🎬   │ 📸Instagram                                     │   │
│  │  │     │ 投稿日時: 2024/01/18 12:00                       │   │
│  │  └─────┘ ステータス: ❌ 投稿失敗                          │   │
│  │          エラー: アカウント認証の有効期限切れ              │   │
│  │                                    [再試行] [詳細]         │   │
│  │                                                           │   │
│  └─────────────────────────────────────────────────────────┘   │
│                                                                 │
│  ■ サマリー（過去30日）                                          │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │ 投稿数: 15件  |  成功: 13件  |  失敗: 1件  |  予約: 1件   │   │
│  │ 合計再生数: 156,200  |  合計いいね: 8,432                  │   │
│  └─────────────────────────────────────────────────────────┘   │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

---

## 4. データ項目（データベース設計）

### 4.1 ER図（概要）

```
┌─────────────────┐
│ ScriptGuideline │───> User
└─────────────────┘

┌─────────────────┐
│  SnsAccount     │───> User
└─────────────────┘

┌─────────────┐     ┌─────────────┐     ┌─────────────┐
│    User     │────<│   Project   │────<│  Variation  │
└─────────────┘     └─────────────┘     └─────────────┘
                           │                   │
                           │                   │
┌─────────────┐            │                   │
│   Product   │────────────┘                   │
└─────────────┘                                │
                                               │
                    ┌─────────────┐            │
                    │   Script    │────────────┤
                    └─────────────┘            │
                           │                   │
              ┌────────────┼────────────┐      │
              │            │            │      │
    ┌─────────────────┐    │            │      │
    │ ScriptFeedback  │────┘            │      │
    └─────────────────┘                 │      │
                                        │      │
                    ┌─────────────┐     │      │
                    │     Cut     │─────┘      │
                    └─────────────┘            │
                           │                   │
              ┌────────────┴────────────┐      │
              │                         │      │
       ┌─────────────┐          ┌─────────────┐
       │GeneratedVideo│         │GeneratedAudio│
       └─────────────┘          └─────────────┘

                    ┌─────────────┐     ┌─────────────┐
                    │  BgmTrack   │────<│ SelectedBgm │───> Variation
                    └─────────────┘     └─────────────┘

┌─────────────┐     ┌─────────────┐
│ FinalVideo  │────<│    Post     │───> SnsAccount
└─────────────┘     └─────────────┘
```

### 4.2 テーブル定義

#### User（ユーザー）

| カラム名 | 型 | 制約 | 説明 |
|---------|-----|------|------|
| id | UUID | PK | ユーザーID |
| email | VARCHAR(255) | UNIQUE, NOT NULL | メールアドレス |
| password_hash | VARCHAR(255) | NOT NULL | パスワードハッシュ |
| name | VARCHAR(100) | NOT NULL | ユーザー名 |
| created_at | TIMESTAMP | NOT NULL | 作成日時 |
| updated_at | TIMESTAMP | NOT NULL | 更新日時 |

#### ScriptGuideline（台本ガイドライン）

| カラム名 | 型 | 制約 | 説明 |
|---------|-----|------|------|
| id | UUID | PK | ガイドラインID |
| user_id | UUID | FK(User) | 所有ユーザー |
| good_practices | TEXT | | 良い台本の特徴・ルール |
| bad_practices | TEXT | | 避けるべきパターン |
| success_examples | TEXT | | 成功事例・参考メモ |
| industry_notes | TEXT | | 業界・商材別の注意点 |
| created_at | TIMESTAMP | NOT NULL | 作成日時 |
| updated_at | TIMESTAMP | NOT NULL | 更新日時 |

#### Product（商品/サービス）

| カラム名 | 型 | 制約 | 説明 |
|---------|-----|------|------|
| id | UUID | PK | 商品ID |
| user_id | UUID | FK(User) | 所有ユーザー |
| name | VARCHAR(200) | NOT NULL | 商品/サービス名 |
| description | TEXT | | 商品説明 |
| usp | TEXT | | USP（独自の強み） |
| price_info | VARCHAR(200) | | 価格帯/オファー情報 |
| target_audience | TEXT | | 想定ターゲット |
| category | VARCHAR(100) | | カテゴリ |
| created_at | TIMESTAMP | NOT NULL | 作成日時 |
| updated_at | TIMESTAMP | NOT NULL | 更新日時 |

#### Project（プロジェクト）

| カラム名 | 型 | 制約 | 説明 |
|---------|-----|------|------|
| id | UUID | PK | プロジェクトID |
| user_id | UUID | FK(User) | 所有ユーザー |
| product_id | UUID | FK(Product) | 対象商品 |
| name | VARCHAR(200) | NOT NULL | プロジェクト名 |
| status | ENUM | NOT NULL | ステータス（ProjectStatus参照） |
| video_duration | INT | NOT NULL | 動画秒数（15/30/60） |
| created_at | TIMESTAMP | NOT NULL | 作成日時 |
| updated_at | TIMESTAMP | NOT NULL | 更新日時 |

#### Variation（バリエーション）

| カラム名 | 型 | 制約 | 説明 |
|---------|-----|------|------|
| id | UUID | PK | バリエーションID |
| project_id | UUID | FK(Project) | 親プロジェクト |
| name | VARCHAR(100) | NOT NULL | バリエーション名（A/B/C等） |
| is_primary | BOOLEAN | DEFAULT false | メインバリエーションか |
| voice_id | VARCHAR(100) | | ナレーション音声ID（ElevenLabs） |
| created_at | TIMESTAMP | NOT NULL | 作成日時 |
| updated_at | TIMESTAMP | NOT NULL | 更新日時 |

#### Script（台本）

| カラム名 | 型 | 制約 | 説明 |
|---------|-----|------|------|
| id | UUID | PK | 台本ID |
| variation_id | UUID | FK(Variation) | 所属バリエーション |
| version | INT | NOT NULL | バージョン番号 |
| status | ENUM | NOT NULL | ステータス（reviewing/approved） |
| parent_script_id | UUID | FK(Script), NULL | 改善元の台本（フィードバック改善時） |
| created_at | TIMESTAMP | NOT NULL | 作成日時 |

#### ScriptInput（台本生成入力）

| カラム名 | 型 | 制約 | 説明 |
|---------|-----|------|------|
| id | UUID | PK | 入力ID |
| script_id | UUID | FK(Script) | 対象台本 |
| **ターゲット設定** |
| persona_age | VARCHAR(50) | | 年齢層 |
| persona_gender | VARCHAR(20) | | 性別 |
| persona_occupation | VARCHAR(100) | | 職業 |
| persona_lifestyle | TEXT | | ライフスタイル |
| persona_problem | TEXT | | 抱えている課題・悩み |
| persona_ideal_state | TEXT | | 理想の状態 |
| **コンテンツ設定** |
| main_message | TEXT | NOT NULL | メインメッセージ |
| content_type | ENUM | | コンテンツタイプ |
| hook_copy | TEXT | | フック（冒頭3秒） |
| ending_copy | TEXT | | エンディング（締めの一言） |
| **トンマナ設定** |
| video_taste | ENUM | | 動画のテイスト |
| visual_style | ENUM | | 映像スタイル |
| **Veo向け設定** |
| character_setting | TEXT | | 登場人物設定 |
| location_setting | TEXT | | ロケーション設定 |
| **追加設定** |
| required_keywords | TEXT[] | | 必須キーワード |
| ng_expressions | TEXT[] | | NG表現 |
| reference_url | VARCHAR(500) | | 参考動画URL |

#### ScriptFeedback（台本フィードバック）

| カラム名 | 型 | 制約 | 説明 |
|---------|-----|------|------|
| id | UUID | PK | フィードバックID |
| script_id | UUID | FK(Script) | 対象台本（改善前） |
| improved_script_id | UUID | FK(Script) | 改善後の台本 |
| feedback_text | TEXT | NOT NULL | ユーザーからのフィードバック内容 |
| created_at | TIMESTAMP | NOT NULL | 作成日時 |

#### Cut（カット）

| カラム名 | 型 | 制約 | 説明 |
|---------|-----|------|------|
| id | UUID | PK | カットID |
| script_id | UUID | FK(Script) | 所属台本 |
| cut_number | INT | NOT NULL | カット番号 |
| cut_type | VARCHAR(50) | | カットタイプ（フック/問題提起/解決策等） |
| start_time | DECIMAL(5,2) | NOT NULL | 開始時間（秒） |
| end_time | DECIMAL(5,2) | NOT NULL | 終了時間（秒） |
| duration | DECIMAL(5,2) | NOT NULL | 秒数 |
| video_instruction | TEXT | NOT NULL | 映像指示（Veo向けプロンプト） |
| dialogue | TEXT | | セリフ・テキスト |
| narration_enabled | BOOLEAN | DEFAULT true | ナレーション有無 |
| narration_tone | VARCHAR(50) | | ナレーショントーン |
| bgm_level | ENUM | | BGMレベル（none/subtle/normal） |
| created_at | TIMESTAMP | NOT NULL | 作成日時 |
| updated_at | TIMESTAMP | NOT NULL | 更新日時 |

#### GeneratedVideo（生成動画）

| カラム名 | 型 | 制約 | 説明 |
|---------|-----|------|------|
| id | UUID | PK | 生成動画ID |
| cut_id | UUID | FK(Cut) | 対象カット |
| file_path | VARCHAR(500) | NULL | ファイルパス（GCS）※生成完了時に設定 |
| generation_status | ENUM | NOT NULL | ステータス（GenerationStatus参照） |
| veo_job_id | VARCHAR(200) | | Veo APIジョブID |
| prompt_used | TEXT | | 使用したプロンプト |
| retry_count | INT | DEFAULT 0 | リトライ回数 |
| error_message | TEXT | | エラーメッセージ（失敗時） |
| generation_started_at | TIMESTAMP | | 生成開始日時 |
| generation_completed_at | TIMESTAMP | | 生成完了日時 |
| created_at | TIMESTAMP | NOT NULL | 作成日時 |

#### GeneratedAudio（生成音声）

| カラム名 | 型 | 制約 | 説明 |
|---------|-----|------|------|
| id | UUID | PK | 生成音声ID |
| cut_id | UUID | FK(Cut) | 対象カット |
| file_path | VARCHAR(500) | NULL | ファイルパス（GCS）※生成完了時に設定 |
| generation_status | ENUM | NOT NULL | ステータス（GenerationStatus参照） |
| voice_id | VARCHAR(100) | | ElevenLabs Voice ID |
| retry_count | INT | DEFAULT 0 | リトライ回数 |
| error_message | TEXT | | エラーメッセージ（失敗時） |
| generation_started_at | TIMESTAMP | | 生成開始日時 |
| generation_completed_at | TIMESTAMP | | 生成完了日時 |
| created_at | TIMESTAMP | NOT NULL | 作成日時 |

#### FinalVideo（最終動画）

| カラム名 | 型 | 制約 | 説明 |
|---------|-----|------|------|
| id | UUID | PK | 最終動画ID |
| variation_id | UUID | FK(Variation) | 対象バリエーション |
| file_path | VARCHAR(500) | NOT NULL | ファイルパス（GCS） |
| resolution | VARCHAR(20) | NOT NULL | 解像度（1080x1920） |
| duration | INT | NOT NULL | 動画秒数 |
| file_size | BIGINT | | ファイルサイズ（bytes） |
| created_at | TIMESTAMP | NOT NULL | 作成日時 |

#### BgmTrack（BGM素材）

| カラム名 | 型 | 制約 | 説明 |
|---------|-----|------|------|
| id | UUID | PK | BGM ID |
| name | VARCHAR(200) | NOT NULL | 曲名 |
| file_path | VARCHAR(500) | NOT NULL | ファイルパス（GCS） |
| category | ENUM | NOT NULL | カテゴリ |
| duration | INT | NOT NULL | 曲の長さ（秒） |
| bpm | INT | | BPM |
| mood | VARCHAR(100) | | 雰囲気タグ |
| is_active | BOOLEAN | DEFAULT true | 有効/無効 |
| created_at | TIMESTAMP | NOT NULL | 作成日時 |

#### SelectedBgm（選択BGM）

| カラム名 | 型 | 制約 | 説明 |
|---------|-----|------|------|
| id | UUID | PK | 選択BGM ID |
| variation_id | UUID | FK(Variation) | 対象バリエーション |
| bgm_track_id | UUID | FK(BgmTrack) | 選択したBGM |
| volume_level | INT | DEFAULT 50 | 音量レベル（0-100） |
| start_offset | DECIMAL(5,2) | DEFAULT 0 | 曲の開始位置（秒） |
| created_at | TIMESTAMP | NOT NULL | 作成日時 |

#### SnsAccount（SNS連携アカウント）

| カラム名 | 型 | 制約 | 説明 |
|---------|-----|------|------|
| id | UUID | PK | アカウントID |
| user_id | UUID | FK(User) | 所有ユーザー |
| platform | ENUM | NOT NULL | プラットフォーム（tiktok/instagram/facebook） |
| platform_user_id | VARCHAR(200) | NOT NULL | プラットフォーム側のユーザーID |
| platform_username | VARCHAR(200) | | アカウント名（@xxx） |
| access_token | TEXT | NOT NULL | アクセストークン（暗号化） |
| refresh_token | TEXT | | リフレッシュトークン（暗号化） |
| token_expires_at | TIMESTAMP | | トークン有効期限 |
| is_active | BOOLEAN | DEFAULT true | 有効/無効 |
| connected_at | TIMESTAMP | NOT NULL | 連携日時 |
| created_at | TIMESTAMP | NOT NULL | 作成日時 |
| updated_at | TIMESTAMP | NOT NULL | 更新日時 |

#### Post（投稿）

| カラム名 | 型 | 制約 | 説明 |
|---------|-----|------|------|
| id | UUID | PK | 投稿ID |
| final_video_id | UUID | FK(FinalVideo) | 投稿する動画 |
| sns_account_id | UUID | FK(SnsAccount) | 投稿先アカウント |
| caption | TEXT | | キャプション（説明文） |
| hashtags | TEXT[] | | ハッシュタグ配列 |
| status | ENUM | NOT NULL | ステータス（PostStatus参照） |
| scheduled_at | TIMESTAMP | | 予約投稿日時（即時投稿の場合はNULL） |
| posted_at | TIMESTAMP | | 実際の投稿日時 |
| platform_post_id | VARCHAR(200) | | プラットフォーム側の投稿ID |
| platform_post_url | VARCHAR(500) | | 投稿URL |
| error_message | TEXT | | エラーメッセージ（失敗時） |
| retry_count | INT | DEFAULT 0 | リトライ回数 |
| created_at | TIMESTAMP | NOT NULL | 作成日時 |
| updated_at | TIMESTAMP | NOT NULL | 更新日時 |

#### PostMetrics（投稿パフォーマンス）

| カラム名 | 型 | 制約 | 説明 |
|---------|-----|------|------|
| id | UUID | PK | メトリクスID |
| post_id | UUID | FK(Post) | 対象投稿 |
| views | BIGINT | DEFAULT 0 | 再生数 |
| likes | BIGINT | DEFAULT 0 | いいね数 |
| comments | BIGINT | DEFAULT 0 | コメント数 |
| shares | BIGINT | DEFAULT 0 | シェア数 |
| fetched_at | TIMESTAMP | NOT NULL | 取得日時 |
| created_at | TIMESTAMP | NOT NULL | 作成日時 |

### 4.3 ENUM定義

```prisma
enum ProjectStatus {
  DRAFT              // 下書き
  SCRIPT_REVIEWING   // 台本レビュー中
  SCRIPT_APPROVED    // 台本承認済み
  GENERATING         // 動画生成中
  COMPLETED          // 完了
  FAILED             // 失敗
}

enum ScriptStatus {
  REVIEWING          // レビュー中（フィードバック待ち）
  APPROVED           // 承認済み（動画生成可能）
}

enum ContentType {
  INFORMATIVE     // 情報提供
  RELATABLE       // 共感・あるある
  HOWTO           // ハウツー・チュートリアル
  ENTERTAINMENT   // エンタメ・おもしろ
  STORYTELLING    // ストーリー・体験談
}

enum VideoTaste {
  CASUAL          // カジュアル
  FORMAL          // フォーマル
  HUMOR           // ユーモア
  EMOTIONAL       // エモーショナル
}

enum VisualStyle {
  REALISTIC       // 実写風
  CINEMATIC       // シネマティック
  ANIME           // アニメ風
  MINIMAL         // ミニマル
}

enum BgmLevel {
  NONE            // なし
  SUBTLE          // 控えめ
  NORMAL          // 通常
}

enum GenerationStatus {
  PENDING         // 待機中
  IN_PROGRESS     // 生成中
  COMPLETED       // 完了
  FAILED          // 失敗
}

enum BgmCategory {
  UPBEAT          // アップビート
  CORPORATE       // コーポレート
  EMOTIONAL       // エモーショナル
  MINIMAL         // ミニマル
  POP             // ポップ
}

enum SnsPlatform {
  TIKTOK          // TikTok
  INSTAGRAM       // Instagram Reels
  FACEBOOK        // Facebook
}

enum PostStatus {
  DRAFT           // 下書き
  SCHEDULED       // スケジュール済み
  POSTING         // 投稿中
  POSTED          // 投稿完了
  FAILED          // 投稿失敗
}
```

---

## 5. カット割り自動算出ロジック

### 5.1 秒数別カット数の目安

| 動画秒数 | 推奨カット数 | 1カットあたり平均秒数 |
|---------|-------------|---------------------|
| 15秒 | 3-4カット | 3.75-5秒 |
| 30秒 | 5-7カット | 4.3-6秒 |
| 60秒 | 8-12カット | 5-7.5秒 |

### 5.2 カット構成テンプレート

#### 15秒動画（4カット構成）
| カット | 秒数 | 役割 |
|-------|------|------|
| 1 | 3秒 | フック（掴み） |
| 2 | 4秒 | 問題提起・共感 |
| 3 | 5秒 | メインコンテンツ |
| 4 | 3秒 | エンディング |

#### 30秒動画（6カット構成）
| カット | 秒数 | 役割 |
|-------|------|------|
| 1 | 3秒 | フック（掴み） |
| 2 | 5秒 | 問題提起・共感 |
| 3 | 6秒 | 解決策・ポイント1 |
| 4 | 6秒 | ポイント2・補足 |
| 5 | 5秒 | まとめ |
| 6 | 5秒 | エンディング |

#### 60秒動画（10カット構成）
| カット | 秒数 | 役割 |
|-------|------|------|
| 1 | 3秒 | フック（掴み） |
| 2 | 5秒 | 問題提起・共感 |
| 3 | 7秒 | 深掘り・背景説明 |
| 4 | 6秒 | 解決策・ポイント1 |
| 5 | 7秒 | ポイント2・詳細 |
| 6 | 7秒 | ポイント3・実例 |
| 7 | 6秒 | 補足・注意点 |
| 8 | 6秒 | 体験談・証拠 |
| 9 | 5秒 | まとめ |
| 10 | 8秒 | エンディング・締め |

---

## 6. 外部API連携

### 6.1 Google Veo 3.1（動画生成）

**使用用途**: 各カットの映像生成

**連携フロー**:
1. カットごとの映像指示からVeo用プロンプトを生成
2. Veo APIに生成リクエスト送信
3. ジョブIDを保存し、ポーリングで完了を監視
4. 完了後、生成動画をGCSに保存

**プロンプト構成要素**:
- 登場人物の外見・服装
- ロケーション・背景
- アクション・動き
- カメラアングル・動き
- ライティング・雰囲気
- アスペクト比（9:16固定）

**エラー処理**:
- 生成失敗時は最大3回までリトライ
- コンテンツポリシー違反の場合はプロンプトを調整して再生成
- 3回失敗した場合はエラー通知を表示し、プロンプト修正を促す

**生成時間の目安**:
- 1カット（3-8秒）あたり: 2-5分

### 6.2 Google Gemini（台本生成）

**使用用途**: ユーザー入力に基づく台本・カット割りの自動生成

**連携フロー**:
1. ユーザーが入力した情報を構造化
2. 動画秒数に応じたカット数テンプレートを選択
3. Gemini APIにプロンプトを送信
4. JSON形式で台本データを受け取り
5. パース後、DB保存

#### 6.2.1 初回台本生成プロンプト

```
あなたはTikTok/Instagram Reels向けの縦型ショート動画の台本作成のプロフェッショナルです。
以下の情報に基づいて、{動画秒数}秒のショート動画の台本を作成してください。

【台本作成ガイドライン】※必ず遵守すること
{良い台本の特徴・ルール}

【避けるべきパターン】
{避けるべきパターン}

【参考にすべき成功事例】
{成功事例・参考メモ}

【ジャンル別注意点】
{ジャンル別の注意点}

---

【テーマ/商品情報】
- テーマ: {テーマ}
- 伝えたいポイント: {ポイント}

【ターゲット】
- ペルソナ: {ペルソナ詳細}
- 課題/悩み: {課題}
- 理想の状態: {理想状態}

【コンテンツ設定】
- メインメッセージ: {メインメッセージ}
- コンテンツタイプ: {コンテンツタイプ}
- フック: {フック}
- エンディング: {エンディング}

【トンマナ】
- テイスト: {テイスト}
- 映像スタイル: {映像スタイル}

【Veo向け設定】
- 登場人物: {登場人物設定}
- ロケーション: {ロケーション設定}

【制約】
- 必須キーワード: {必須キーワード}
- NG表現: {NG表現}

カット数は{カット数}カットで、以下のJSON形式で出力してください:
{出力フォーマット}
```

#### 6.2.2 フィードバック改善プロンプト

```
あなたはTikTok/Instagram Reels向けの縦型ショート動画の台本作成のプロフェッショナルです。
以下の台本に対してフィードバックがありました。
フィードバックを反映して、改善版の台本を作成してください。

【台本作成ガイドライン】※必ず遵守すること
{良い台本の特徴・ルール}

【避けるべきパターン】
{避けるべきパターン}

---

【現在の台本】
{現在の台本JSON}

【ユーザーからのフィードバック】
{フィードバック内容}

---

フィードバックを踏まえて改善した台本を、同じJSON形式で出力してください。
変更した箇所には "changed": true を追加してください。
```

#### 6.2.3 出力フォーマット（JSON）

```json
{
  "cuts": [
    {
      "cut_number": 1,
      "cut_type": "フック",
      "duration": 3,
      "video_instruction": "Veo向けの映像指示",
      "dialogue": "セリフ/テキスト",
      "narration_tone": "疑問を投げかける",
      "bgm_level": "none",
      "changed": false
    }
  ]
}
```

### 6.3 ElevenLabs（ナレーション生成）

**使用用途**: 各カットのナレーション音声生成

**連携フロー**:
1. カットのセリフテキストを取得
2. 選択されたVoice + トーン・感情に基づいてパラメータ設定
3. ElevenLabs APIに音声生成リクエスト送信
4. 生成された音声ファイルをGCSに保存

**Voice選択**（プロジェクト単位で設定）:
| Voice名 | タイプ | 特徴 |
|---------|-------|------|
| Yuki | 女性・20代 | 明るくカジュアル |
| Hana | 女性・30代 | 落ち着いた信頼感 |
| Takeshi | 男性・30代 | 力強くエネルギッシュ |
| Kenji | 男性・40代 | 落ち着いた説得力 |

※実際のVoice IDはElevenLabsで日本語対応のものを選定

**設定項目**:
- Voice ID（上記から選択）
- Stability（安定性: 0.0-1.0）
- Similarity Boost（類似度: 0.0-1.0）
- Style（スタイル: 0.0-1.0）

**対応言語**: 日本語

**エラー処理**:
- 生成失敗時は最大3回までリトライ
- 3回失敗した場合はエラー通知を表示

### 6.4 BGM（ロイヤリティフリー素材）

**方式**: 事前にロイヤリティフリーBGM素材をシステムに登録し、ユーザーが選択

**素材カテゴリ**:
| カテゴリ | 用途 |
|---------|------|
| アップビート | エネルギッシュな訴求 |
| コーポレート | ビジネス向け |
| エモーショナル | 感情訴求系 |
| ミニマル | 控えめなBGM |
| ポップ | カジュアル・若年層向け |

**管理方法**:
- GCSに素材を格納
- DBでメタデータ（カテゴリ、秒数、BPM等）を管理
- 動画秒数に応じて自動トリミング or ループ

### 6.5 動画結合・ミキシング処理

**使用用途**: 各カットの動画・音声を結合して最終動画を生成

**処理フロー**:
1. 全カットの動画・ナレーション生成完了を確認
2. カット順に動画を結合
3. 各カットのナレーション音声を動画に合成
4. 選択されたBGMを動画全体にミキシング
   - ナレーションがある箇所はBGM音量を自動で下げる（ダッキング）
5. 最終動画ファイルをGCSに保存
6. FinalVideoレコードを作成

**技術選択肢**:
- FFmpeg（サーバーサイドで実行）
- Google Cloud Video Intelligence API（将来検討）

**出力仕様**:
- フォーマット: MP4 (H.264)
- 解像度: 1080 x 1920
- フレームレート: 30fps
- 音声: AAC, ステレオ

### 6.6 SNS投稿API

#### 6.6.1 TikTok Content Posting API

**使用用途**: TikTokオーガニックアカウントへの動画投稿

**必要な権限**:
- `video.upload` - 動画アップロード
- `video.publish` - 動画公開

**連携フロー**:
1. OAuth 2.0でユーザー認証・認可
2. 動画ファイルをアップロード
3. キャプション・ハッシュタグを設定して公開

**対応アカウント**:
- 個人アカウント
- クリエイターアカウント

**制限事項**:
- 動画長さ: 最大10分
- ファイルサイズ: 最大4GB
- サポート形式: MP4, MOV, MPEG, AVI

**レート制限**: 
- 1日あたり100リクエスト（目安）

#### 6.6.2 Meta Graph API（Instagram / Facebook）

**使用用途**: Instagram Reels / Facebookへの動画投稿

**必要な権限**:
- `instagram_content_publish` - Instagram投稿
- `pages_manage_posts` - Facebookページ投稿
- `pages_read_engagement` - エンゲージメント取得

**連携フロー（Instagram Reels）**:
1. OAuth 2.0でユーザー認証・認可
2. 動画をアップロードしてコンテナ作成
3. コンテナを公開

**連携フロー（Facebook）**:
1. ページアクセストークンを取得
2. 動画をページにアップロード
3. 説明文を設定して公開

**制限事項（Instagram Reels）**:
- 動画長さ: 3秒〜90秒
- アスペクト比: 9:16
- 解像度: 最小500x888

**制限事項（Facebook）**:
- 動画長さ: 最大240分
- ファイルサイズ: 最大10GB

#### 6.6.3 スケジュール投稿処理

**実行方式**: Cloud Scheduler + Cloud Functions（またはCloud Run Jobs）

**処理フロー**:
1. Cloud Schedulerが1分ごとにジョブをトリガー
2. scheduled_atが現在時刻以前の投稿を検索
3. 該当する投稿をSNS APIで実行
4. 結果をDBに保存
5. 成功/失敗をユーザーに通知

**通知方法**:
- アプリ内通知（ダッシュボードに表示）
- メール通知（オプション）

#### 6.6.4 パフォーマンス取得

**取得タイミング**:
- 投稿後1時間ごと（最初の24時間）
- その後は1日1回

**取得項目**:
- 再生数
- いいね数
- コメント数
- シェア数

---

## 7. 非機能要件

### 7.1 パフォーマンス
- 台本生成: 30秒以内
- 動画生成: カットあたり5分以内（目標）
- 画面遷移: 2秒以内

### 7.2 セキュリティ
- 認証: JWTベース認証
  - アクセストークン有効期限: 1時間
  - リフレッシュトークン有効期限: 7日間
- パスワード: bcryptでハッシュ化（ソルトラウンド: 10）
- HTTPS必須
- APIキー管理: 環境変数で管理（GCP Secret Manager推奨）

### 7.3 可用性
- 目標稼働率: 99%
- データバックアップ: 日次

### 7.4 ストレージ
- 動画ファイル: Google Cloud Storage
- 保持期間: 無期限（容量に応じて検討）

---

## 8. 将来拡張（Phase 2以降）

### 優先度高
- [ ] 字幕/テロップ自動生成（動画内に焼き込み）
- [ ] パフォーマンス分析ダッシュボード（再生数、エンゲージメント率の推移）

### 優先度中
- [ ] ブランドガイドライン設定機能（ロゴ、カラー、フォント）
- [ ] チーム/複数ユーザー対応
- [ ] 動画テンプレート機能（成功パターンをテンプレート化）
- [ ] カスタムVoice追加（ElevenLabs Voice Cloning）
- [ ] AIによるキャプション・ハッシュタグ自動生成

### 優先度低
- [ ] 効果音ライブラリ追加
- [ ] 多言語対応（英語、中国語等）
- [ ] 横型動画（16:9）対応
- [ ] リアルタイムプレビュー機能
- [ ] YouTube Shorts対応

