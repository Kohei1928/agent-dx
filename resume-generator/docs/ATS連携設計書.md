# ATS連携設計書

## 概要

本設計書は、各ATS（採用管理システム）との連携方法を定義します。

---

## 対象ATS

| ATS名 | API公開 | 連携方式 | 優先度 |
|-------|---------|----------|--------|
| **HRMOS** | ⚠️ 限定公開 | スクレイピング or API申請 | 高 |
| **採用一括かんりくん** | ✅ あり | API連携（要確認） | 高 |
| **ジョブカン採用管理** | ⚠️ 限定公開 | スクレイピング or API申請 | 中 |
| **リクナビHRTech** | ❓ 不明 | 調査必要 | 低 |

---

## 連携アーキテクチャ

```
┌─────────────────────────────────────────────────────────────┐
│  より転-DX                                                   │
│                                                             │
│  ┌─────────────────────────────────────────────────────┐   │
│  │  企業マスタ / 求人マスタ                              │   │
│  └─────────────────────────────────────────────────────┘   │
│                          ▲                                  │
│                          │                                  │
│            ┌─────────────┼─────────────┐                   │
│            │             │             │                   │
│            ▼             ▼             ▼                   │
│     ┌──────────┐  ┌──────────┐  ┌──────────┐             │
│     │ HubSpot  │  │  CSV     │  │  ATS     │             │
│     │ 連携     │  │ インポート│  │ 連携     │             │
│     └──────────┘  └──────────┘  └──────────┘             │
│                                       │                    │
└───────────────────────────────────────┼────────────────────┘
                                        │
                ┌───────────────────────┼───────────────────┐
                │                       │                   │
                ▼                       ▼                   ▼
         ┌──────────┐           ┌──────────┐        ┌──────────┐
         │  HRMOS   │           │一括かんり│        │ジョブカン│
         │          │           │  くん    │        │          │
         └──────────┘           └──────────┘        └──────────┘
```

---

## 連携方式

### 方式1: 公式API連携（推奨）

```typescript
// API連携の基本構造
interface ATSConnector {
  name: string;
  authenticate(): Promise<void>;
  fetchJobs(): Promise<Job[]>;
  fetchCompanies(): Promise<Company[]>;
  syncJob(job: Job): Promise<void>;
}
```

**メリット:**
- 安定した連携
- 公式サポートあり
- リアルタイム同期可能

**デメリット:**
- API利用申請が必要
- 追加費用の可能性

### 方式2: スクレイピング（Puppeteer/Playwright）

```typescript
// スクレイピングの基本構造
interface ATSScraper {
  login(credentials: Credentials): Promise<void>;
  navigateToJobList(): Promise<void>;
  extractJobs(): Promise<Job[]>;
  extractJobDetail(url: string): Promise<JobDetail>;
}
```

**メリット:**
- API不要
- 即座に開発可能

**デメリット:**
- UI変更に弱い
- 利用規約リスク
- メンテナンスコスト高

### 方式3: Chrome拡張機能

既存の `circus-ats-copier` 拡張機能を拡張し、ATSから求人情報を取得。

```
┌─────────────────────────────────────────────────────────┐
│  Chrome拡張機能                                          │
│                                                         │
│  ┌─────────────────────────────────────────────────┐   │
│  │  Content Script                                  │   │
│  │  - ATSページからデータ抽出                        │   │
│  │  - より転-DXにデータ送信                          │   │
│  └─────────────────────────────────────────────────┘   │
│                                                         │
└─────────────────────────────────────────────────────────┘
```

**対応済みATS:**
- Circus
- sonarATS
- talentio
- HRMOS

**追加対応予定:**
- 採用一括かんりくん
- ジョブカン

---

## データモデル

### 求人データマッピング

| より転-DX | HRMOS | 一括かんりくん | ジョブカン |
|-----------|-------|----------------|------------|
| title | job_title | 求人名 | 求人タイトル |
| description | job_description | 仕事内容 | 業務内容 |
| requirements | requirements | 応募資格 | 必須条件 |
| salaryMin | salary_min | 年収下限 | 給与下限 |
| salaryMax | salary_max | 年収上限 | 給与上限 |
| companyName | company_name | 企業名 | 会社名 |

### 企業データマッピング

| より転-DX | HRMOS | 一括かんりくん | ジョブカン |
|-----------|-------|----------------|------------|
| name | company_name | 企業名 | 会社名 |
| industry | industry | 業種 | 業界 |
| headquarters | address | 所在地 | 住所 |
| employeeCount | employees | 従業員数 | 社員数 |

---

## 実装計画

### Phase 1: Chrome拡張機能の強化（1週間）

1. 既存拡張機能に「より転-DX連携」モードを追加
2. 求人情報抽出機能の強化
3. より転-DXへのAPI送信機能

### Phase 2: 一括かんりくん連携（1週間）

1. API仕様の確認・申請
2. APIクライアント実装
3. 同期機能の実装

### Phase 3: ジョブカン連携（1週間）

1. API仕様の確認・申請
2. APIクライアント実装
3. 同期機能の実装

### Phase 4: HRMOS連携強化（1週間）

1. Chrome拡張でのデータ抽出強化
2. API申請（可能であれば）
3. 自動同期機能

---

## セキュリティ考慮事項

1. **認証情報の管理**
   - ATSの認証情報は暗号化して保存
   - アクセストークンの定期更新

2. **データ保護**
   - 転送時のTLS暗号化
   - 個人情報の適切な取り扱い

3. **利用規約遵守**
   - 各ATSの利用規約を確認
   - スクレイピング時のリクエスト制限

---

## API エンドポイント設計

### ATS連携設定

```
GET  /api/ats/connections          # 連携一覧
POST /api/ats/connections          # 連携追加
PUT  /api/ats/connections/:id      # 連携更新
DELETE /api/ats/connections/:id    # 連携削除
```

### ATS同期

```
POST /api/ats/:provider/sync/jobs       # 求人同期
POST /api/ats/:provider/sync/companies  # 企業同期
GET  /api/ats/:provider/jobs            # 求人取得
GET  /api/ats/:provider/companies       # 企業取得
```

---

## 次のアクション

1. [ ] 一括かんりくんにAPI利用申請
2. [ ] ジョブカンにAPI利用申請
3. [ ] Chrome拡張機能の「より転-DX連携」モード開発
4. [ ] ATS連携設定画面の実装
5. [ ] 同期履歴・ログ機能の実装

